subscribes: order.approval.requested
publishes: order.approval.responded

activities:
  a1:
    title: Get Approval
    type: trigger
    output:
      schema:
        $ref: '../schemas/order.approval.requested.yaml#/a1/output'
    return:
      schema:
        $ref: '../schemas/order.approval.requested.yaml#/a1/return'
  a2:
    title: Get Price Approval
    type: await
    subtype: order.approval.price.requested
    input:
      schema:
        $ref: '../schemas/order.approval.requested.yaml#/a2/input'
      maps:
        $ref: '../maps/order.approval.requested.yaml#/a2/input'
    output:
      schema:
        $ref: '../schemas/order.approval.requested.yaml#/a2/output'
  a3:
    title: Return True
    type: return
    input:
      maps:
        $ref: '../maps/order.approval.requested.yaml#/a3/input'
  a4:
    title: Return False
    type: return
    input:
      maps:
        $ref: '../maps/order.approval.requested.yaml#/a4/input'

transitions:
  a1:
    - to: a2
  a2:
    - to: a3
      conditions:
        match:
          - expected: true
            actual: "{a2.output.data.approved}"
    - to: a4
      conditions:
        match:
          - expected: false
            actual: "{a2.output.data.approved}"
